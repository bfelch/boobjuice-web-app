name: Python Testing

on:
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log Level'
        required: true
        default: 'warning'
        type: choice
        options:
        - info
        - warning
        - debug
  # push:
  #   branches:
  #     - dev

jobs:
  build:
  
    runs-on: ubuntu-latest
    steps:
      - name: Start MariaDB
        # You may pin to the exact commit or the version.
        # uses: getong/mariadb-action@d6d2ec41fd5588f369be4c9398ce77ee725ca9ea
        uses: getong/mariadb-action@v1.11
        with:
          # The port of host
          host port: 3306
          # The port of container
          container port: 3306
          # --character-set-server - The character set of MySQL server
          character set server: utf8mb4
          # --collation-server - The character collation of MySQL server
          collation server: utf8mb4_general_ci
          # Version of MariaDB to use
          mariadb version: 1.1.10
          # MYSQL_ROOT_PASSWORD - root superuser password
          mysql root password: ${{ secrets.TEST_DB_ROOT_PASSWORD }}
          # MYSQL_DATABASE - name for the default database that is created
          mysql database: boobjuiceDb
          # MYSQL_USER - create the specified user with superuser power for created database
          mysql user: boobjuiceUser
          # MYSQL_PASSWORD - specified superuser password which user is power for created database
          mysql password: ${{ secrets.TEST_DB_PASSWORD }}
          
      - name: Run pytest
        # You may pin to the exact commit or the version.
        # uses: pavelzw/pytest-action@c9e5b9c8d93290ff47dcf6a28c6b19ca0b42e487
        uses: pavelzw/pytest-action@v2.1.0
        with:
          # Print a GitHub job summary
          job-summary: true
          # Verbose output
          verbose: true
          # Use emojis in the output
          emoji: true
          # Custom command to replace the `pytest` call. Can be a custom executable or something like `poetry run pytest` or `micromamba run -n myenv pytest`.
          custom-pytest: pytest
          # Title of the report
          report-title: Test Report
          # Add 'Click to expand' to the report
          click-to-expand: true
          
